\hypertarget{structaffinity}{}\section{affinity Struct Reference}
\label{structaffinity}\index{affinity@{affinity}}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{structaffinity_abe34f20b4d661e9ed44ca5def0470e00}{set} (const std\+::size\+\_\+t desired\+\_\+core)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 6 of file affinity.\+hpp.



\subsection{Member Function Documentation}
\hypertarget{structaffinity_abe34f20b4d661e9ed44ca5def0470e00}{}\label{structaffinity_abe34f20b4d661e9ed44ca5def0470e00} 
\index{affinity@{affinity}!set@{set}}
\index{set@{set}!affinity@{affinity}}
\subsubsection{\texorpdfstring{set()}{set()}}
{\footnotesize\ttfamily void affinity\+::set (\begin{DoxyParamCaption}\item[{const std\+::size\+\_\+t}]{desired\+\_\+core }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

end if linux not linux 

Definition at line 43 of file affinity.\+cpp.



Referenced by simple\+\_\+schedule\+::simple\+\_\+run().


\begin{DoxyCode}
44 \{
45 \textcolor{preprocessor}{#ifdef \_\_linux}
46 \textcolor{comment}{   /**}
47 \textcolor{comment}{    * pin the current thread }
48 \textcolor{comment}{    */}
49    cpu\_set\_t   *cpuset( \textcolor{keyword}{nullptr} );
50    \textcolor{keyword}{auto} cpu\_allocate\_size( -1 );
51 \textcolor{preprocessor}{#if   (\_\_GLIBC\_MINOR\_\_ > 9 ) && (\_\_GLIBC\_\_ == 2 )}
52    \textcolor{keyword}{const} \textcolor{keyword}{auto}  processors\_to\_allocate( 1 );
53    cpuset = CPU\_ALLOC( processors\_to\_allocate );
54    assert( cpuset != \textcolor{keyword}{nullptr} );
55    cpu\_allocate\_size = CPU\_ALLOC\_SIZE( processors\_to\_allocate );
56    CPU\_ZERO\_S( cpu\_allocate\_size, cpuset );
57 \textcolor{preprocessor}{#else}
58    cpu\_allocate\_size = \textcolor{keyword}{sizeof}( cpu\_set\_t );
59    cpuset = (cpu\_set\_t*) malloc( cpu\_allocate\_size );
60    assert( cpuset != \textcolor{keyword}{nullptr} );
61    CPU\_ZERO( cpuset );
62 \textcolor{preprocessor}{#endif}
63    CPU\_SET( desired\_core,
64             cpuset );
65    errno = 0;
66    \textcolor{keywordflow}{if}( sched\_setaffinity( 0 \textcolor{comment}{/* calling thread */},
67                          cpu\_allocate\_size,
68                          cpuset ) != 0 )
69    \{
70       \textcolor{keyword}{const} \textcolor{keyword}{static} \textcolor{keyword}{auto} buff\_length( 1000 );
71       \textcolor{keywordtype}{char} buffer[ buff\_length ];
72       std::memset( buffer, \textcolor{charliteral}{'\(\backslash\)0'}, buff\_length );\textcolor{comment}{}
73 \textcolor{comment}{      /** XSI-compliant, but also GNU version, shouldn't need to check **/}\textcolor{comment}{}
74 \textcolor{comment}{/**}
75 \textcolor{comment}{#if (\_POSIX\_C\_SOURCE >= 200112L || \_XOPEN\_SOURCE >= 600) && ! \_GNU\_SOURCE}
76 \textcolor{comment}{**/}
77       \textcolor{keyword}{const} \textcolor{keywordtype}{char} *str( strerror\_r( errno, buffer, buff\_length ) );
78       std::cerr << \textcolor{stringliteral}{"failed to set affinity, desired core( "} << desired\_core << \textcolor{stringliteral}{" )"};
79       std::cerr << \textcolor{stringliteral}{" exited with error ( "} << str << \textcolor{stringliteral}{" ).\(\backslash\)n"};
80       exit( EXIT\_FAILURE );
81    \}\textcolor{comment}{}
82 \textcolor{comment}{   /** wait till we know we're on the right processor **/}
83    \textcolor{keywordflow}{if}( sched\_yield() != 0 )
84    \{
85       perror( \textcolor{stringliteral}{"Failed to yield to wait for core change!\(\backslash\)n"} );
86    \}
87 \textcolor{preprocessor}{#else }\textcolor{comment}{/** not linux **/}\textcolor{preprocessor}{}
88 \textcolor{preprocessor}{#if defined \_\_APPLE\_\_}
89 \textcolor{preprocessor}{#warning "No thread pinning for this platform, your results may vary!"}
90 UNUSED( desired\_core );
91 \textcolor{preprocessor}{#elif defined \_WIN64 || defined \_WIN32}
92 \textcolor{preprocessor}{#pragma message ( "No thread pinning for this platform, your results may vary!" )}
93 UNUSED( desired\_core );
94 \textcolor{preprocessor}{#endif}
95 \textcolor{preprocessor}{#endif}
96    \textcolor{keywordflow}{return};
97 \}
\end{DoxyCode}


The documentation for this struct was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
affinity.\+hpp\item 
affinity.\+cpp\end{DoxyCompactItemize}
